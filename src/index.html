<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Extend App</title>

  <base href="/" />

  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
        <script>
            let miCanvas;
            let lineas = [];

            $(document).ready(() =>{
                miCanvas = document.getElementById('firma');
                let correccionX = 0;
                let correccionY = 0;
                let pintarLinea = false;
                let nuevaPosicionX = 0;
                let nuevaPosicionY = 0;
                let ctx;

                let posicion = miCanvas.getBoundingClientRect()
                correccionX = posicion.x;
                correccionY = posicion.y;

                miCanvas.width = 600;
                miCanvas.height = 250;

                if (window.matchMedia("(min-width: 320px)").matches){
                    miCanvas.width = 350;
                    miCanvas.height = 250;
                }
                if (window.matchMedia("(min-width: 500px)").matches){
                    miCanvas.width = 458;
                    miCanvas.height = 250;
                }
                if (window.matchMedia("(min-width: 768px)").matches){
                    miCanvas.width = 420;
                    miCanvas.height = 250;
                }
                if (window.matchMedia("(min-width: 992px)").matches){
                    miCanvas.width = 616;
                    miCanvas.height = 250;
                }

                limpiar.addEventListener('click', function(evt){
                    pintarLinea = false;
                    ctx.clearRect(0, 0, miCanvas.width, miCanvas.height);
                    lineas = [];
                }, false);

                function empezarDibujo() {
                    pintarLinea = true;
                    lineas.push([]);
                };

                function guardarLinea() {
                        lineas[lineas.length - 1].push({
                        x: nuevaPosicionX,
                        y: nuevaPosicionY
                    });
                }

                function dibujarLinea(event) {
                    event.preventDefault();
                    if(pintarLinea){
                        ctx = miCanvas.getContext('2d')
                        ctx.lineJoin = ctx.lineCap = 'round';
                        ctx.lineWidth = 1;
                        ctx.strokeStyle = '#000000';
                        if(event.changedTouches == undefined) {
                            nuevaPosicionX = event.layerX;
                            nuevaPosicionY = event.layerY;
                        }else{
                            nuevaPosicionX = event.changedTouches[0].pageX - correccionX;
                            nuevaPosicionY = event.changedTouches[0].pageY - correccionY;
                        }
                        guardarLinea();
                        // Redibuja todas las lineas guardadas
                        ctx.beginPath();
                        lineas.forEach(function (segmento) {
                        ctx.moveTo(segmento[0].x, segmento[0].y);
                            segmento.forEach(function (punto, index) {
                                ctx.lineTo(punto.x, punto.y);
                            });
                        });
                        ctx.stroke();
                    }
                }

                function pararDibujar () {
                    pintarLinea = false;
                    guardarLinea();
                }

                miCanvas.addEventListener('mousedown', empezarDibujo, false);
                miCanvas.addEventListener('mousemove', dibujarLinea, false);
                miCanvas.addEventListener('mouseup', pararDibujar, false);

                miCanvas.addEventListener('touchstart', empezarDibujo, false);
                miCanvas.addEventListener('touchmove', dibujarLinea, false);
            });
        </script>

  <meta name="color-scheme" content="light dark" />
  <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />

  <link rel="icon" type="image/png" href="assets/icon/favicon.png" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;900&display=swap');
    </style>

  <!-- add to homescreen for ios -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />

  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Srisakdi" rel="stylesheet">



</head>

<body class="montserrat">
  <app-root></app-root>
</body>

</html>
